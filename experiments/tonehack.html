<!DOCTYPE html>
<html>
    <head>
        <title>Tonehack</title>
        <meta charset='utf-8' />
        <script type='text/javascript' src='jquery.min.js'></script>
        <script type='text/javascript'>

            window.requestAnimFrame = (function(){
                return  window.requestAnimationFrame || 
                  window.webkitRequestAnimationFrame || 
                  window.mozRequestAnimationFrame || 
                  window.oRequestAnimationFrame || 
                  window.msRequestAnimationFrame || 
                  function(callback, element){
                      window.setTimeout(callback, 1000 / 60);
                };
            })();

            debug = false;
            
            function standingWave(context, index, freq, amplitude, width) {
                var amplitude = amplitude;
                var step = 0.0;
                var standing = Math.PI / width;
                var freq = freq;
                var freq_diff = standing / (440/freq);
                var step_diff = freq/2000;
                var position = index * (HEIGHT / 5);
                this.draw = function() {
                    step += step_diff;
                    if(step >= Math.PI*2) {
                        step = 0.0;
                    }
                    current_amplitude = Math.sin(step) * amplitude;
                    //context.clearRect(0,0,WIDTH,HEIGHT);
                    if(debug) {
                        context.fillStyle = "rgba(30, 30, 30, 0.3)";
                    } else {
                        context.fillStyle = "rgba(0, 0, 0, 0.3)";
                    }
                    context.fillRect(0, position-amplitude-10, WIDTH, amplitude*2+20);

                    context.lineWidth = 2;
                    context.strokeStyle = "#fff";
                
                    var x = -6, y = this.sin(x, freq_diff, current_amplitude);
                    while(x < WIDTH) {
                        context.beginPath();
                        context.moveTo(x + 0.5, y + position);
                        y = this.sin(x, freq_diff, current_amplitude);
                        x += 4;
                        context.lineTo(x + 0.5, y + position);
                        context.stroke();
                    }
                };
                this.sin = function(x, rad_diff, amplitude) {
                    return -amplitude * Math.sin(rad_diff * x);
                };
            }
                    
        
            $(document).ready(function(){
                var canvas = $('<canvas>');
                $('#canvas-container').append(canvas);
                WIDTH=canvas.innerWidth(), HEIGHT=canvas.innerHeight();

                canvas = canvas.get(0);
                canvas.height = HEIGHT;
                canvas.width = WIDTH;
                context = canvas.getContext("2d");


                var waves = [
                    new standingWave(context, 1, 440, 30, WIDTH),
                    new standingWave(context, 2, 440*2, 30, WIDTH),
                    new standingWave(context, 3, 440*3, 30, WIDTH),
                    new standingWave(context, 4, 440*4, 30, WIDTH),
                ];

                function animLoop() {
                    requestAnimFrame(animLoop);
                    for(i = 0; i < waves.length; i++) {
                        waves[i].draw();
                    }
                }
                animLoop();
            });

        </script>
        <style type='text/css'>
        
            html, body { margin: 0; padding: 0; background: #000; }
            #canvas-container {  }
            #canvas-container canvas { display: block; width: 1024px; height: 480px; margin: 100px auto; border: 2px solid #fff; box-shadow: 0 0 10px 1px rgba(100, 166, 0, 0.9), 0 0 35px 5px rgba(255,255,255,0.4); }
            
        </style>
    </head>
    <body>
        <div id='canvas-container'></div>
    </body>
</html>
