<!DOCTYPE html>
<html>
    <head>
        <title>Tonehack</title>
        <meta charset='utf-8' />
        <script type='text/javascript' src='jquery.min.js'></script>
        <script type='text/javascript'>
function gcd(text1,text2){
var gcd=1;
if (text1>text2) {text1=text1+text2; text2=text1-text2; text1=text1-text2;}
if ((text2==(Math.round(text2/text1))*text1)) {gcd=text1}else {
for (var i = Math.round(text1/2) ; i > 1; i=i-1) {
if ((text1==(Math.round(text1/i))*i))
if ((text2==(Math.round(text2/i))*i)) {gcd=i; i=-1;}
}
}
return gcd;
}

function lcm(t1,t2){
var cm=1;
var f=gcd(t1,t2);
cm=t1*t2/f;
return cm;
}

            window.requestAnimFrame = (function(){
                return  window.requestAnimationFrame || 
                  window.webkitRequestAnimationFrame || 
                  window.mozRequestAnimationFrame || 
                  window.oRequestAnimationFrame || 
                  window.msRequestAnimationFrame || 
                  function(callback, element){
                      window.setTimeout(callback, 1000 / 60);
                };
            })();

            debug = false;
            
            function standingWave(context, index, freq, amplitude) {
                var amplitude = amplitude;
                var step = 0.0;
                var standing = Math.PI / context.width;
                var freq = freq;
                var freq_diff = freq * standing / 440; // calculate relative wavelength
                var step_diff = freq * (1/3000); // calculate relative frequency
                var position = index * (context.height / (wavelengths.length+1));
                this.draw = function() {
                    step += step_diff;
                    if(step >= Math.PI*2) {
                        step = 0.0;
                    }
                    current_amplitude = Math.sin(step) * amplitude;
                    if(debug) {
                        context.fillStyle = "rgba(30, 30, 30, 0.3)";
                    } else {
                        context.fillStyle = "rgba(0, 0, 0, 0.5)";
                    }
                    context.fillRect(0, position-amplitude-10, context.width, amplitude*2+20);

                    context.lineWidth = 4;
                    context.strokeStyle = "#fff";
                
                    var x = 0, y = this.sin(x, freq_diff, current_amplitude);
                    while(x < context.width) {
                        context.beginPath();
                        context.moveTo(x, y + position);
                        x += 4;
                        y = this.sin(x, freq_diff, current_amplitude);
                        context.lineTo(x, y + position);
                        context.stroke();
                    }
                };
                this.sin = function(x, rad_diff, amplitude) {
                    return -amplitude * Math.sin(rad_diff * x);
                };
            }
                    
        
            $(document).ready(function(){
                var canvas_jq = $('<canvas>');
                $('#canvas-container').append(canvas_jq);
                canvas = canvas_jq.get(0);
                canvas.height = canvas_jq.innerWidth();
                canvas.width = canvas_jq.innerHeight();
                context = canvas.getContext("2d");
                // just to be able to access directly from context object
                context.width = canvas.width;
                context.height = canvas.height;

                wavelengths = [440, 440*2, 440*3];

                var waves = [];
                for(i = 0; i < wavelengths.length; i++) {
                    var amplitude = (context.height / wavelengths.length) / 3;
                    waves.push(new standingWave(context, i+1, wavelengths[i], amplitude));
                }

                function drawFrame() {
                    for(i = 0; i < waves.length; i++) {
                        waves[i].draw();
                    }
                }
                function animLoop() {
                    if(run) {
                        requestAnimFrame(animLoop);
                        drawFrame();
                    }
                }
                drawFrame();

                $('.start').click(function(e){
                    e.preventDefault();
                    run = true;
                    animLoop();
                });
                $('.stop').click(function(e){
                    e.preventDefault();
                    run = false;
                });
            });

            run = true;

        </script>
        <style type='text/css'>
        
            html, body { margin: 0; padding: 0; background: #000; color: #fff; font-family: Georgia; }
            a { color: #fff; border-bottom: 3px solid #fff; display: inline-block; text-decoration: none;}
            #canvas-container { width: 1028px; margin: 50px auto;  }
            #canvas-container canvas { display: block; width: 1024px; height: 480px; margin: 0 auto; border: 2px solid #fff; }
            
        </style>
    </head>
    <body>
        <div id='canvas-container'>
            <div class='controls'><a href='#' class='start'>start</a> / <a href='#' class='stop'>stop</a></div>
        </div>
    </body>
</html>
